

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>psef.linters &mdash; CodeGrade v1.17.4 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link href="../../_static/style.css" rel="stylesheet" type="text/css">

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                v1.17.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guides/use-codegrade-as-a-student.html">How to use CodeGrade as a student</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/getting-started-with-codegrade.html">Getting started with CodeGrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/autotest-best-practices.html">Best Practices for AutoTest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/creating-an-assignment.html">Create a CodeGrade assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/set-up-a-rubric-for-an-assignment.html">Set up a rubric for an assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/setting-up-autotest.html">Setting up AutoTest</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/enabling-continuous-feedback-for-an-assignment.html">Enabling Continuous Feedback for an assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/set-up-group-assignment.html">Set up a CodeGrade group assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/setting-up-hand-in-requirements.html">Set up hand-in requirements for a CodeGrade assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/setting-up-git-uploads.html">Set up Git uploads for a CodeGrade assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/checking-for-plagiarism.html">Check for plagiarism in a CodeGrade assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/dividing-submissions.html">Divide submissions over graders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/pass-back-grades-to-canvas-blackboard-moodle-brightspace.html">Pass back grades to Canvas, Blackboard, Moodle or Brightspace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/creating-managing-and-using-snippets.html">Create, manage and use snippets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/setup-password-for-codegrade-account.html">Set up a password for my CodeGrade account</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/using-shortcuts.html">Using shortcuts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/cannot-find-feature-in-codegrade.html">I cannot find a feature in CodeGrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/installing-codegrade-filesystem.html">Install the CodeGrade Filesystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guides/use-codegrade-filesystem.html">Use the CodeGrade Filesystem to locally mount CodeGrade</a></li>
</ul>
<p class="caption"><span class="caption-text">User Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user/overview.html">Overview of CodeGrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/codeviewer.html">Code Viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/management.html">Course and Assignment Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/plagiarism.html">Plagiarism Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/groups.html">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/permissions.html">Permissions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/preferences.html">Settings and Site Preferences</a></li>
<li class="toctree-l1"><a class="reference external" href="https://fs-docs.codegra.de">Filesystem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/lms.html">LMS Integration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user/autotest/overview.html">AutoTest</a></li>
</ul>
<p class="caption"><span class="caption-text">About CodeGrade</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/about.html">About CodeGrade</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developerdocs.html">Developer documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CodeGrade</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../psef.html">psef</a> &raquo;</li>
        
      <li>psef.linters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for psef.linters</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains all the linters that are integrated in the service.</span>

<span class="sd">Integrated linters are ran by the :class:`LinterRunner` and thus implement run</span>
<span class="sd">method.</span>

<span class="sd">SPDX-License-Identifier: AGPL-3.0-only</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">typing</span> <span class="k">as</span> <span class="nn">t</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="kn">import</span> <span class="nn">structlog</span>
<span class="kn">from</span> <span class="nn">defusedxml.ElementTree</span> <span class="kn">import</span> <span class="n">fromstring</span> <span class="k">as</span> <span class="n">defused_xml_fromstring</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">app</span><span class="p">,</span> <span class="n">files</span><span class="p">,</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">db</span>
<span class="kn">from</span> <span class="nn">.helpers</span> <span class="kn">import</span> <span class="n">register</span><span class="p">,</span> <span class="n">format_list</span><span class="p">,</span> <span class="n">maybe_wrap_in_list</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="n">ValidationException</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">structlog</span><span class="o">.</span><span class="n">get_logger</span><span class="p">()</span>

<span class="n">T_LINTER</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T_LINTER&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="s1">&#39;Linter&#39;</span><span class="p">)</span>  <span class="c1"># pylint: disable=invalid-name</span>
<span class="n">_NICE_LEVEL</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">ProcessCompletedCallback</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">],</span> <span class="kc">None</span><span class="p">]</span>


<div class="viewcode-block" id="init_app"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.init_app">[docs]</a><span class="k">def</span> <span class="nf">init_app</span><span class="p">(</span><span class="n">_</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">pass</span></div>


<span class="n">_linter_handlers</span><span class="p">:</span> <span class="n">register</span><span class="o">.</span><span class="n">Register</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;Linter&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">register</span><span class="o">.</span><span class="n">Register</span><span class="p">(</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_read_config_file</span><span class="p">(</span><span class="n">config_cat</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">config_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">pardir</span><span class="p">,</span>
            <span class="s1">&#39;resources&#39;</span><span class="p">,</span>
            <span class="n">config_cat</span><span class="p">,</span>
            <span class="n">config_name</span><span class="p">,</span>
        <span class="p">),</span> <span class="s1">&#39;r&#39;</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">_run_command</span><span class="p">(</span><span class="n">cmd</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">preexec_fn</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">nice</span><span class="p">(</span><span class="n">_NICE_LEVEL</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>  <span class="c1"># pylint: disable=bare-except</span>
            <span class="k">pass</span>

    <span class="c1"># The check for success is something we really don&#39;t want here.</span>
    <span class="k">return</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>  <span class="c1"># pylint: disable=subprocess-run-check</span>
        <span class="n">cmd</span><span class="p">,</span>
        <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">stderr</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">preexec_fn</span><span class="o">=</span><span class="n">preexec_fn</span><span class="p">,</span>
    <span class="p">)</span>


<div class="viewcode-block" id="LinterCrash"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.LinterCrash">[docs]</a><span class="k">class</span> <span class="nc">LinterCrash</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The exception to use that a linter has crashed.</span>

<span class="sd">    This is a semi-controlled crash, so it should be used when the linter</span>
<span class="sd">    process itself returned some unexpected code or invalid output. It should</span>
<span class="sd">    not be used for programming errors within CodeGrade code processing the</span>
<span class="sd">    output of the linter.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">error_summary</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_summary</span> <span class="o">=</span> <span class="n">error_summary</span></div>


<div class="viewcode-block" id="Linter"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Linter">[docs]</a><span class="k">class</span> <span class="nc">Linter</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The base class for a linter.</span>

<span class="sd">    Every linter should inherit from this class as they are discovered by</span>
<span class="sd">    reflecting on subclasses from this class. They should override the ``run``</span>
<span class="sd">    method, and they may override the ``DEFAULT_OPTIONS`` variable. If</span>
<span class="sd">    ``RUN_LINTER`` is set to ``False`` we never actually run the linter, but</span>
<span class="sd">    only create a :py:class:`.models.AssignmentLinter` for this assignment and</span>
<span class="sd">    a :py:class:`.models.LinterInstance` for each submission.</span>

<span class="sd">    .. note::</span>

<span class="sd">        If a linter doesn&#39;t override ``DEFAULT_OPTIONS`` the user will not have</span>
<span class="sd">        the ability to define a custom configuration for the linter in the</span>
<span class="sd">        frontend.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_OPTIONS</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">ClassVar</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">RUN_LINTER</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">cfg</span>

    <span class="c1"># pylint: disable=unused-argument</span>
<div class="viewcode-block" id="Linter.validate_config"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Linter.validate_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">T_LINTER</span><span class="p">],</span> <span class="n">config</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Verify if the config is correct.</span>

<span class="sd">        This method should never return something but raise a</span>
<span class="sd">        :class:`.ValidationException` instead.</span>

<span class="sd">        :param config: The config to validate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Linter.run"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Linter.run">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tempdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">emit</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">process_completed</span><span class="p">:</span> <span class="n">ProcessCompletedCallback</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
        <span class="sd">&quot;&quot;&quot;Run the linter on the code in `tempdir`.</span>

<span class="sd">        :param tempdir: The temp directory that should contain the code to</span>
<span class="sd">            run the linter on.</span>
<span class="sd">        :param emit: A callback to emit a line of feedback, where the first</span>
<span class="sd">            argument is the filename, the second is the line number, the third</span>
<span class="sd">            is the code of the linter error, and the fourth and last is the</span>
<span class="sd">            message of the linter.</span>
<span class="sd">        :param process_completed: The callback that should be called, directly,</span>
<span class="sd">            after the process has been completed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;A subclass should implement this function!&#39;</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Pylint"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Pylint">[docs]</a><span class="nd">@_linter_handlers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;Pylint&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Pylint</span><span class="p">(</span><span class="n">Linter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;The pylint checker.</span>

<span class="sd">    This checks python modules for many common errors. It only works on proper</span>
<span class="sd">    modules and will display an error on the first line of every file if the</span>
<span class="sd">    given code was not a proper module.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_OPTIONS</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">ClassVar</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Empty config file&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Pylint.run"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Pylint.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tempdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">emit</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">process_completed</span><span class="p">:</span> <span class="n">ProcessCompletedCallback</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Run the pylinter.</span>

<span class="sd">        Arguments are the same as for :py:meth:`Linter.run`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="n">out</span> <span class="o">=</span> <span class="n">_run_command</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">part</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">tempdir</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PYLINT_PROGRAM&#39;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">process_completed</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">32</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LinterCrash</span>
        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LinterCrash</span><span class="p">(</span>
                <span class="n">error_summary</span><span class="o">=</span><span class="p">(</span>
                    <span class="s1">&#39;The submission is not a valid python module, it probably&#39;</span>
                    <span class="s1">&#39; lacks an `__init__` file.&#39;</span>
                <span class="p">),</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">err</span> <span class="ow">in</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">emit</span><span class="p">(</span>
                    <span class="n">err</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">],</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">err</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]),</span>
                    <span class="n">err</span><span class="p">[</span><span class="s1">&#39;message-id&#39;</span><span class="p">],</span>
                    <span class="n">err</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">pass</span></div></div>


<div class="viewcode-block" id="Flake8"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Flake8">[docs]</a><span class="nd">@_linter_handlers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;Flake8&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Flake8</span><span class="p">(</span><span class="n">Linter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the Flake8 linter.</span>

<span class="sd">    This linter checks for errors in python code and checks the pep8 python</span>
<span class="sd">    coding standard. All &quot;noqa&quot;s are disabled when running.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_OPTIONS</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">ClassVar</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Empty config file&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span>

<div class="viewcode-block" id="Flake8.run"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Flake8.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tempdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">emit</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">process_completed</span><span class="p">:</span> <span class="n">ProcessCompletedCallback</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># This is not guessable</span>
        <span class="n">sep</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span>
        <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%(path)s{0}%(row)d{0}%(code)s{0}%(text)s</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">_run_command</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">part</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">tempdir</span><span class="p">,</span> <span class="n">line_fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;FLAKE8_PROGRAM&#39;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">process_completed</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">returncode</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">LinterCrash</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sep</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">emit</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="k">pass</span></div></div>


<div class="viewcode-block" id="MixedWhitespace"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.MixedWhitespace">[docs]</a><span class="nd">@_linter_handlers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;MixedWhitespace&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">MixedWhitespace</span><span class="p">(</span><span class="n">Linter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the MixedWhitespace linter.</span>

<span class="sd">    This linter checks if a file contains mixed indentation on the same line.</span>
<span class="sd">    It doesn&#39;t catch different types of indentation being used in a file but on</span>
<span class="sd">    different lines. Instead of adding a comment in the sidebar, the mixed</span>
<span class="sd">    whitespace will be highlighted in the code.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">RUN_LINTER</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">ClassVar</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="MixedWhitespace.run"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.MixedWhitespace.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tempdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">emit</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">process_completed</span><span class="p">:</span> <span class="n">ProcessCompletedCallback</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
        <span class="c1"># This method should never be called as ``RUN_LINTER`` is set to</span>
        <span class="c1"># ``false..</span>
        <span class="k">assert</span> <span class="kc">False</span></div></div>


<div class="viewcode-block" id="Checkstyle"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Checkstyle">[docs]</a><span class="nd">@_linter_handlers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;Checkstyle&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Checkstyle</span><span class="p">(</span><span class="n">Linter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the Checkstyle linter.</span>

<span class="sd">    This checks java source files for common errors. It is configured by a xml</span>
<span class="sd">    file. It is not possible to upload your own checkers, neither is it</span>
<span class="sd">    possible to supply some properties such as `basedir` and `file`.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_OPTIONS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Google style&#39;</span><span class="p">:</span> <span class="n">_read_config_file</span><span class="p">(</span><span class="s1">&#39;checkstyle&#39;</span><span class="p">,</span> <span class="s1">&#39;google.xml&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Sun style&#39;</span><span class="p">:</span> <span class="n">_read_config_file</span><span class="p">(</span><span class="s1">&#39;checkstyle&#39;</span><span class="p">,</span> <span class="s1">&#39;sun.xml&#39;</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_validate_module</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;Checkstyle&#39;</span><span class="p">],</span> <span class="n">mod</span><span class="p">:</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                    <span class="s1">&#39;The given config is not valid&#39;</span><span class="p">,</span> <span class="p">(</span>
                        <span class="s1">&#39;Invalid module used, only default checkstyle &#39;</span>
                        <span class="s1">&#39;modules are supported&#39;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="k">for</span> <span class="n">sub_el</span> <span class="ow">in</span> <span class="n">mod</span><span class="p">:</span>
                <span class="n">validate_func</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_validate_func</span><span class="p">(</span><span class="n">sub_el</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">validate_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">validate_func</span><span class="p">(</span><span class="n">sub_el</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_validate_property</span><span class="p">(</span><span class="n">prop</span><span class="p">:</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">attrib</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">attrib</span>
        <span class="k">if</span> <span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="s1">&#39;basedir&#39;</span><span class="p">,</span> <span class="s1">&#39;cacheFile&#39;</span><span class="p">,</span> <span class="s1">&#39;haltOnException&#39;</span><span class="p">,</span> <span class="s1">&#39;file&#39;</span>
        <span class="p">}:</span>
            <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                <span class="s1">&#39;The given config is not valid&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;Invalid property &quot;</span><span class="si">{attrib[&quot;name&quot;]}</span><span class="s1">&quot; found&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">prop</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                <span class="s1">&#39;The given config is not valid&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;A property cannot have children&#39;</span>
            <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_validate_func</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;Checkstyle&#39;</span><span class="p">],</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
                           <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">],</span> <span class="kc">None</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;property&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_property</span><span class="p">,</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_validate_module</span><span class="p">,</span>
            <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="Checkstyle.validate_config"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Checkstyle.validate_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;Checkstyle&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check if the given config is valid for checkstyle.</span>

<span class="sd">        This also does some extra checks to make sure some invalid properties</span>
<span class="sd">        are not present.</span>

<span class="sd">        :param config: The config to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xml_config</span><span class="p">:</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">defused_xml_fromstring</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">xml_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                <span class="s1">&#39;The given xml config could not be parsed.&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;The config </span><span class="si">{config}</span><span class="s1"> could not be parsed as xml.&#39;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">xml_config</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s1">&#39;module&#39;</span> <span class="ow">or</span> <span class="n">xml_config</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;name&#39;</span>
        <span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;Checker&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                <span class="s1">&#39;The given config is not valid.&#39;</span><span class="p">,</span>
                <span class="s1">&#39;The given top module of the config should be Checker.&#39;</span>
            <span class="p">)</span>
        <span class="k">for</span> <span class="n">sub_el</span> <span class="ow">in</span> <span class="n">xml_config</span><span class="p">:</span>
            <span class="n">validate_func</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_validate_func</span><span class="p">(</span><span class="n">sub_el</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">validate_func</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                    <span class="s1">&#39;The given config is not valid&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;Unknown tag &quot;</span><span class="si">{sub_el.tag}</span><span class="s1">&quot; encountered&#39;</span>
                <span class="p">)</span>
            <span class="n">validate_func</span><span class="p">(</span><span class="n">sub_el</span><span class="p">)</span></div>

<div class="viewcode-block" id="Checkstyle.run"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.Checkstyle.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tempdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">emit</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">process_completed</span><span class="p">:</span> <span class="n">ProcessCompletedCallback</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Run checkstyle</span>

<span class="sd">        Arguments are the same as for :py:meth:`Linter.run`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tempdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">module</span><span class="p">:</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">defused_xml_fromstring</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">module</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">assert</span> <span class="n">module</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;Checker&#39;</span>
            <span class="n">module</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">module</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span>
                    <span class="s1">&#39;property&#39;</span><span class="p">,</span> <span class="p">{</span>
                        <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;basedir&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;$</span><span class="si">{basedir}</span><span class="s1">&#39;</span>
                    <span class="p">}</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
                <span class="sd">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="sd">&lt;!DOCTYPE module PUBLIC</span>
<span class="sd">          &quot;-//Checkstyle//DTD Checkstyle Configuration 1.3//EN&quot;</span>
<span class="sd">          &quot;https://checkstyle.org/dtds/configuration_1_3.dtd&quot;&gt;\n&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;unicode&#39;</span><span class="p">))</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="n">out</span> <span class="o">=</span> <span class="n">_run_command</span><span class="p">(</span>
                <span class="n">format_list</span><span class="p">(</span>
                    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CHECKSTYLE_PROGRAM&#39;</span><span class="p">],</span>
                    <span class="n">config</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                    <span class="n">files</span><span class="o">=</span><span class="n">tempdir</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">process_completed</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">254</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">LinterCrash</span><span class="p">(</span>
                    <span class="s1">&#39;The given submission could not be parsed as valid java&#39;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">output</span><span class="p">:</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">defused_xml_fromstring</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">file_el</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">file_el</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s1">&#39;file&#39;</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                    <span class="k">continue</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">file_el</span><span class="o">.</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">error_el</span> <span class="ow">in</span> <span class="n">file_el</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">error_el</span><span class="o">.</span><span class="n">tag</span> <span class="o">!=</span> <span class="s1">&#39;error&#39;</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                        <span class="k">continue</span>
                    <span class="n">attrib</span> <span class="o">=</span> <span class="n">error_el</span><span class="o">.</span><span class="n">attrib</span>
                    <span class="n">emit</span><span class="p">(</span>
                        <span class="n">filename</span><span class="p">,</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]),</span>
                        <span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;severity&#39;</span><span class="p">,</span> <span class="s1">&#39;warning&#39;</span><span class="p">),</span>
                        <span class="n">attrib</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">],</span>
                    <span class="p">)</span></div></div>


<div class="viewcode-block" id="PMD"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.PMD">[docs]</a><span class="nd">@_linter_handlers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;PMD&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PMD</span><span class="p">(</span><span class="n">Linter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the PMD linter.</span>

<span class="sd">    This checks java source files for common errors. It is configured by a xml</span>
<span class="sd">    file. It is not possible to upload your own rules, neither is it</span>
<span class="sd">    possible to use XPath rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_OPTIONS</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">ClassVar</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Maven&#39;</span><span class="p">:</span> <span class="n">_read_config_file</span><span class="p">(</span><span class="s1">&#39;pmd&#39;</span><span class="p">,</span> <span class="s1">&#39;maven.xml&#39;</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="PMD.validate_config"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.PMD.validate_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;PMD&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check if the given config is valid for PMD.</span>

<span class="sd">        This also does some extra checks to make sure some invalid properties</span>
<span class="sd">        are not present.</span>

<span class="sd">        :param config: The config to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xml_config</span><span class="p">:</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span> <span class="o">=</span> <span class="n">defused_xml_fromstring</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">xml_config</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                <span class="s1">&#39;The given xml config could not be parsed.&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;The config </span><span class="si">{config}</span><span class="s1"> could not be parsed as xml.&#39;</span>
            <span class="p">)</span>
        <span class="n">stack</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">xml_config</span><span class="p">]</span>

        <span class="k">while</span> <span class="n">stack</span><span class="p">:</span>
            <span class="n">cur</span> <span class="o">=</span> <span class="n">stack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">stack</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">cur</span><span class="p">)</span>
            <span class="n">class_el</span> <span class="o">=</span> <span class="n">cur</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">class_el</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s1">&#39;xpathrule&#39;</span> <span class="ow">in</span> <span class="n">class_el</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                    <span class="s1">&#39;XPath rules cannot be used.&#39;</span><span class="p">,</span> <span class="p">(</span>
                        <span class="s1">&#39;The given config is invalid as XPath rules are&#39;</span>
                        <span class="s1">&#39; not allowed.&#39;</span>
                    <span class="p">)</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="PMD.run"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.PMD.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tempdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">emit</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">process_completed</span><span class="p">:</span> <span class="n">ProcessCompletedCallback</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Run PMD.</span>

<span class="sd">        Arguments are the same as for :py:meth:`Linter.run`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tempdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="n">out</span> <span class="o">=</span> <span class="n">_run_command</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">part</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">tempdir</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;PMD_PROGRAM&#39;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">process_completed</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">out</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">stdout</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;File&#39;</span><span class="p">]</span>
                <span class="n">line_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="s1">&#39;Line&#39;</span><span class="p">])</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="s1">&#39;Rule set&#39;</span><span class="p">]</span>

                <span class="n">emit</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ESLint"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.ESLint">[docs]</a><span class="nd">@_linter_handlers</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s1">&#39;ESLint&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ESLint</span><span class="p">(</span><span class="n">Linter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run the ESLint linter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_OPTIONS</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">ClassVar</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Standard&#39;</span><span class="p">:</span> <span class="n">_read_config_file</span><span class="p">(</span><span class="s1">&#39;eslint&#39;</span><span class="p">,</span> <span class="s1">&#39;standard.json&#39;</span><span class="p">)</span>
    <span class="p">}</span>

<div class="viewcode-block" id="ESLint.validate_config"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.ESLint.validate_config">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="s1">&#39;ESLint&#39;</span><span class="p">],</span> <span class="n">config</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Check if the given config is valid for ESLint.</span>

<span class="sd">        This also does some extra checks to make sure some invalid properties</span>
<span class="sd">        are not present.</span>

<span class="sd">        &gt;&gt;&gt; ESLint.validate_config(&#39;{&quot;extends&quot;: &quot;./a_path&quot;}&#39;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValidationException: ...</span>
<span class="sd">        &gt;&gt;&gt; ESLint.validate_config(&#39;{&quot;extends&quot;: &quot;plugin:a_path&quot;}&#39;)</span>
<span class="sd">        &gt;&gt;&gt; ESLint.validate_config(&#39;{&quot;extends&quot;: &quot;a/path&#39;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValidationException: ...</span>
<span class="sd">        &gt;&gt;&gt; ESLint.validate_config(&#39;{&quot;extends&quot;: &quot;/path&#39;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        ValidationException: ...</span>

<span class="sd">        :param config: The config to check.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">json_config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                <span class="s1">&#39;The given json config could not be parsed.&#39;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s1">&#39;The config </span><span class="si">{config}</span><span class="s1"> could not be parsed as json.&#39;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">plugin</span> <span class="ow">in</span> <span class="n">json_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;plugins&#39;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">plugin</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                    <span class="s1">&#39;Plugins cannot be paths&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;The plugin </span><span class="si">{plugin}</span><span class="s1"> contains a slash&#39;</span>
                <span class="p">)</span>

        <span class="k">for</span> <span class="n">extend</span> <span class="ow">in</span> <span class="n">maybe_wrap_in_list</span><span class="p">(</span><span class="n">json_config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;extends&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)):</span>
            <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">extend</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">extend</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;plugin:&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">extend</span>
            <span class="p">):</span>
                <span class="k">raise</span> <span class="n">ValidationException</span><span class="p">(</span>
                    <span class="s1">&#39;Base configs cannot be paths&#39;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s1">&#39;The base config (</span><span class="si">{extend}</span><span class="s1">) as paths are not supported&#39;</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="ESLint.run"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.ESLint.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">tempdir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">emit</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">process_completed</span><span class="p">:</span> <span class="n">ProcessCompletedCallback</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Run ESLint.</span>

<span class="sd">        Arguments are the same as for :py:meth:`Linter.run`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tempdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">tempdir</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">cfg</span><span class="p">:</span>
            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;root&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span>
            <span class="n">cfg</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

            <span class="n">out</span> <span class="o">=</span> <span class="n">_run_command</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">part</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">files</span><span class="o">=</span><span class="n">tempdir</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;ESLINT_PROGRAM&#39;</span><span class="p">]</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">process_completed</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="c1"># Exit code 1 means that linting was successful but that errors</span>
            <span class="c1"># were found.</span>
            <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">returncode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">}:</span>
                <span class="k">raise</span> <span class="n">LinterCrash</span><span class="p">(</span>
                    <span class="n">error_summary</span><span class="o">=</span><span class="p">(</span>
                        <span class="s1">&#39;ESLint crashed, stdout: &quot;</span><span class="si">{}</span><span class="s1">&quot;, stderr: &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;filePath&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">f</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fatal&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Encountered fatal error: </span><span class="si">{msg}</span><span class="s1">&#39;</span><span class="p">)</span>

                    <span class="n">line_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">])</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="s1">&#39;ruleId&#39;</span><span class="p">]</span>

                    <span class="n">emit</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">line_number</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="LinterRunner"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.LinterRunner">[docs]</a><span class="k">class</span> <span class="nc">LinterRunner</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This class is used to run a :class:`Linter` with a specific config on</span>
<span class="sd">    sets of :class:`.models.Work`.</span>

<span class="sd">    .. py:attribute:: linter</span>
<span class="sd">        The attached :class:`Linter` that will be ran by this class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">cls</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">Linter</span><span class="p">],</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a new instance of :class:`LinterRunner`</span>

<span class="sd">        :param Linter cls: The linter to run.</span>
<span class="sd">        :param str cfg: The config as as `str` to pass to the linter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">linter</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

<div class="viewcode-block" id="LinterRunner.run"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.LinterRunner.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">linter_instance_ids</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Run this linter runner on the given works.</span>

<span class="sd">        .. note:: This method takes a long time to execute, please run it in a</span>
<span class="sd">                  thread.</span>

<span class="sd">        :param linter_instance_ids: A sequence of all the ids of the linter</span>
<span class="sd">            instances which should be run. If this linter instance has already</span>
<span class="sd">            run once its old comments will be removed.</span>

<span class="sd">        :returns: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">linter_instance_id</span> <span class="ow">in</span> <span class="n">linter_instance_ids</span><span class="p">:</span>
            <span class="n">linter_inst</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">LinterInstance</span>
                                           <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">linter_instance_id</span><span class="p">)</span>

            <span class="c1"># This should never happen however it is better to check here.</span>
            <span class="k">if</span> <span class="n">linter_inst</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">linter_inst</span><span class="o">.</span><span class="n">work</span><span class="o">.</span><span class="n">deleted</span><span class="p">:</span>  <span class="c1"># pragma: no cover</span>
                <span class="k">continue</span>

            <span class="n">compl_proc</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">def</span> <span class="nf">set_proc</span><span class="p">(</span><span class="n">proc</span><span class="p">:</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CompletedProcess</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">nonlocal</span> <span class="n">compl_proc</span>
                <span class="n">compl_proc</span> <span class="o">=</span> <span class="n">proc</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">linter_inst</span><span class="p">,</span> <span class="n">set_proc</span><span class="p">)</span>
            <span class="c1"># We want to catch all exceptions here as need to set our linter to</span>
            <span class="c1"># the crashed state.</span>
            <span class="k">except</span> <span class="n">LinterCrash</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;The linter crashed&#39;</span><span class="p">,</span>
                    <span class="n">linter_instance_id</span><span class="o">=</span><span class="n">linter_inst</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">linter_inst</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">LinterState</span><span class="o">.</span><span class="n">crashed</span>
                <span class="n">linter_inst</span><span class="o">.</span><span class="n">error_summary</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">error_summary</span> <span class="ow">or</span>
                    <span class="s1">&#39;The linter program exited unsuccessfully.&#39;</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>  <span class="c1"># pylint: disable=broad-except</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;The linter crashed unexpectedly&#39;</span><span class="p">,</span>
                    <span class="n">linter_instance_id</span><span class="o">=</span><span class="n">linter_inst</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">linter_inst</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">LinterState</span><span class="o">.</span><span class="n">crashed</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">compl_proc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">linter_inst</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">compl_proc</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="n">linter_inst</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">compl_proc</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\0</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="LinterRunner.test"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.LinterRunner.test">[docs]</a>    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">linter_instance</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">LinterInstance</span><span class="p">,</span>
        <span class="n">process_completed</span><span class="p">:</span> <span class="n">ProcessCompletedCallback</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Test the given code (:class:`.models.Work`) and add generated</span>
<span class="sd">        comments.</span>

<span class="sd">        :param linter_instance: The linter instance that will be run. This</span>
<span class="sd">            linter instance is linked to a work from which all files will be</span>
<span class="sd">            restored and the linter will be run on those files.</span>
<span class="sd">        :param process_completed: The callback that should be called by the</span>
<span class="sd">            linter instance after the process, like pylint or java, has been</span>
<span class="sd">            completed.</span>
<span class="sd">        :returns: Nothing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">temp_res</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span>
        <span class="n">temp_res</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">res</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>

            <span class="k">def</span> <span class="nf">__emit</span><span class="p">(</span><span class="n">f</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">line</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">):</span>
                    <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                <span class="k">if</span> <span class="n">f</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_res</span><span class="p">:</span>
                    <span class="n">temp_res</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">line</span> <span class="o">=</span> <span class="n">line</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">line</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">temp_res</span><span class="p">[</span><span class="n">f</span><span class="p">]:</span>
                    <span class="n">temp_res</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">temp_res</span><span class="p">[</span><span class="n">f</span><span class="p">][</span><span class="n">line</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">code</span><span class="p">,</span> <span class="n">msg</span><span class="p">))</span>

            <span class="n">tree_root</span> <span class="o">=</span> <span class="n">files</span><span class="o">.</span><span class="n">restore_directory_structure</span><span class="p">(</span>
                <span class="n">linter_instance</span><span class="o">.</span><span class="n">work</span><span class="p">,</span>
                <span class="n">tmpdir</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">linter</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="n">files</span><span class="o">.</span><span class="n">safe_join</span><span class="p">(</span><span class="n">tmpdir</span><span class="p">,</span> <span class="n">tree_root</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">__emit</span><span class="p">,</span>
                <span class="n">process_completed</span>
            <span class="p">)</span>

        <span class="k">del</span> <span class="n">tmpdir</span>

        <span class="k">def</span> <span class="nf">__do</span><span class="p">(</span><span class="n">tree</span><span class="p">:</span> <span class="n">files</span><span class="o">.</span><span class="n">FileTree</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">parent</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># We can safely use os.path.join here as the contents of this path</span>
            <span class="c1"># will never be read.</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tree</span><span class="o">.</span><span class="n">entries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># this is dir:</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">entries</span><span class="p">:</span>
                    <span class="n">__do</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">temp_res</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">tree</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp_res</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">temp_res</span><span class="p">[</span><span class="n">parent</span><span class="p">]</span>

        <span class="n">__do</span><span class="p">(</span><span class="n">tree_root</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="n">meth</span> <span class="o">=</span> <span class="n">logger</span><span class="o">.</span><span class="n">warning</span> <span class="k">if</span> <span class="n">temp_res</span> <span class="k">else</span> <span class="n">logger</span><span class="o">.</span><span class="n">info</span>
        <span class="n">meth</span><span class="p">(</span><span class="s1">&#39;Finished adding linter comments&#39;</span><span class="p">,</span> <span class="n">comments_left</span><span class="o">=</span><span class="n">temp_res</span><span class="p">)</span>

        <span class="n">models</span><span class="o">.</span><span class="n">LinterComment</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">linter_id</span><span class="o">=</span><span class="n">linter_instance</span><span class="o">.</span><span class="n">id</span>
                                             <span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">linter_instance</span><span class="o">.</span><span class="n">add_comments</span><span class="p">(</span><span class="n">res</span><span class="p">):</span>
            <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">comment</span><span class="p">)</span>

        <span class="n">linter_instance</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">LinterState</span><span class="o">.</span><span class="n">done</span>

        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="get_all_linters"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.get_all_linters">[docs]</a><span class="k">def</span> <span class="nf">get_all_linters</span><span class="p">(</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]]:</span>
    <span class="sd">&quot;&quot;&quot;Get an overview of all linters.</span>

<span class="sd">    The returned linters are all the subclasses of :class:`Linter`.</span>

<span class="sd">    :returns: A mapping of the name of the linter to a dictionary containing</span>
<span class="sd">        the description and the default options of the linter with that name</span>

<span class="sd">    .. testsetup::</span>

<span class="sd">        from psef.linters import get_all_linters, Linter</span>

<span class="sd">    .. doctest::</span>

<span class="sd">        &gt;&gt;&gt; @_linter_handlers.register(&#39;MyLinter&#39;)</span>
<span class="sd">        ... class MyLinter(Linter): pass</span>
<span class="sd">        &gt;&gt;&gt; MyLinter.__doc__ = &quot;Description&quot;</span>
<span class="sd">        &gt;&gt;&gt; MyLinter.DEFAULT_OPTIONS = {&#39;wow&#39;: &#39;sers&#39;}</span>
<span class="sd">        &gt;&gt;&gt; all_linters = get_all_linters()</span>
<span class="sd">        &gt;&gt;&gt; sorted(all_linters.keys())</span>
<span class="sd">        [&#39;Checkstyle&#39;, &#39;ESLint&#39;, &#39;Flake8&#39;, &#39;MixedWhitespace&#39;, &#39;MyLinter&#39;, &#39;PMD&#39;, &#39;Pylint&#39;]</span>
<span class="sd">        &gt;&gt;&gt; linter = all_linters[&#39;MyLinter&#39;]</span>
<span class="sd">        &gt;&gt;&gt; linter == {&#39;desc&#39;: &#39;Description&#39;, &#39;opts&#39;: {&#39;wow&#39;: &#39;sers&#39;} }</span>
<span class="sd">        True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">_linter_handlers</span><span class="o">.</span><span class="n">get_all</span><span class="p">():</span>
        <span class="n">item</span><span class="p">:</span> <span class="n">t</span><span class="o">.</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span>
        <span class="n">item</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;desc&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s1">&#39;No linter documentation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;opts&#39;</span><span class="p">:</span> <span class="bp">cls</span><span class="o">.</span><span class="n">DEFAULT_OPTIONS</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">res</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="get_linter_by_name"><a class="viewcode-back" href="../../psef_api/psef.html#psef.linters.get_linter_by_name">[docs]</a><span class="k">def</span> <span class="nf">get_linter_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">Type</span><span class="p">[</span><span class="n">Linter</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;Get the linter class associated with the given name.</span>

<span class="sd">    :param str name: The name of the linter wanted.</span>
<span class="sd">    :returns: The linter with the attribute `__name__` equal to `name`. If</span>
<span class="sd">        there are multiple linters with the name `name` the result can be any</span>
<span class="sd">        one of these linters.</span>
<span class="sd">    :raises KeyError: If the linter with the specified name is not found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_linter_handlers</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, CodeGrade

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>